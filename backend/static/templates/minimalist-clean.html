<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice {{invoiceNumber}}</title>
    <style>
        :root {
            --highlight-color: {{highlightColor || '#059669'}};
            --highlight-light: {{highlightColorLight || '#ecfdf5'}};
            --text-dark: #111827;
            --text-medium: #374151;
            --text-light: #9ca3af;
            --border-color: #d1d5db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page { size: A4; margin: 12mm; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.45;
            color: var(--text-dark);
            padding: 8mm 10mm;
            max-width: 190mm;
            margin: 0 auto;
            background: white;
            font-size: 13px;
        }

        .header {
            margin-bottom: 20px;
            /* float-based layout for wkhtmltopdf compatibility */
        }

    .company-info { float: left; width: 62%; }
    /* Brand row with absolute-positioned logo ensures logo height follows info block height. */
    .brand { position: relative; margin-right: 276px; padding-left: 148px; margin-bottom: 6px; }
    .brand .logo-box { position: absolute; left: 0; top: 0; bottom: 0; width: 140px; padding-right: 8px; }
    .brand .company-info { float: none; width: auto; }
    .brand img.logo { height: 100%; width: auto; display:block; object-fit: contain; max-width: 220px; }
        .invoice-meta { float: right; text-align: left; max-width: 280px; }
        .invoice-meta {
            display: inline-block;
            background: var(--highlight-light);
            border-left: 3px solid var(--highlight-color);
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 12px;
            line-height: 1.4;
        }
        .invoice-meta div { margin: 2px 0; }
        .invoice-title-block { clear: both; padding-top: 8px; }

        .company-info h1 {
            font-size: 20px;
            font-weight: 400;
            color: var(--highlight-color);
            margin-bottom: 6px;
            letter-spacing: 1.5px;
        }

        .company-details {
            color: var(--text-medium);
            font-size: 12px;
            font-weight: 300;
        }

        .invoice-title {
            font-size: 34px;
            font-weight: 200;
            color: var(--text-dark);
            text-align: right;
            letter-spacing: 2px;
        }

        /* Top-of-page title variant */
        .invoice-title--top { text-align: left; margin-bottom: 4px; }
        .invoice-number--top { text-align: left; margin-top: 2px; font-size: 12px; color: var(--text-medium); }

        .invoice-number {
            text-align: right;
            margin-top: 4px;
            font-size: 12px;
            color: var(--text-medium);
            font-weight: 300;
        }

        .dates-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 22px;
            padding: 14px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .date-item {
            text-align: center;
        }

        .date-label {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .date-value {
            font-size: 14px;
            color: var(--text-dark);
            font-weight: 400;
        }

        .customer-section {
            margin-bottom: 24px;
        }

        .section-label {
            font-size: 11px;
            color: var(--highlight-color);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .customer-name {
            font-size: 16px;
            font-weight: 400;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .customer-details {
            color: var(--text-medium);
            font-size: 12px;
            font-weight: 300;
            line-height: 1.5;
        }

        .items-section {
            margin-bottom: 20px;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
        }

        .items-table thead th {
            background: var(--highlight-color);
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .5px;
            border: none;
        }

        .items-table thead th:last-child {
            text-align: right;
        }

        .items-table tbody td {
            padding: 10px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 12px;
            font-weight: 300;
        }
        .items-table { page-break-inside: avoid; }
        tr, td, th { page-break-inside: avoid; }

        @media print {
            body { padding: 0; font-size: 12px; }
            .header { margin-bottom: 16px; }
            .invoice-title { font-size: 28px; }
            table, tr, td, th { page-break-inside: avoid !important; }
        }

        .items-table tbody td:last-child {
            text-align: right;
            font-weight: 400;
        }

        .items-table tbody tr:last-child td {
            border-bottom: 1px solid var(--border-color);
        }

        .item-description {
            color: var(--text-dark);
            font-weight: 400;
            margin-bottom: 4px;
        }

        .item-code {
            color: var(--highlight-color);
            font-size: 12px;
            font-weight: 500;
        }

        .item-notes {
            color: var(--text-light);
            font-size: 12px;
            margin-top: 4px;
        }

        .totals-section {
            margin-left: auto;
            width: 300px;
            margin-bottom: 56px;
        }

        .totals-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
            font-weight: 300;
        }

        .totals-row.subtotal {
            color: var(--text-medium);
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 12px;
            margin-bottom: 8px;
        }

        .totals-row.total {
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
            margin-top: 8px;
            font-size: 18px;
            font-weight: 400;
            color: var(--highlight-color);
        }

        .notes-section {
            margin-bottom: 46px;
        }

        .notes-content {
            color: var(--text-medium);
            font-size: 14px;
            font-weight: 300;
            line-height: 1.7;
            padding: 20px;
            background: var(--highlight-light);
            border-left: 3px solid var(--highlight-color);
        }

        .footer {
            border-top: 1px solid var(--border-color);
            padding-top: 34px;
            text-align: center;
            color: var(--text-light);
            font-size: 12px;
            font-weight: 300;
        }

        .footer p {
            margin: 8px 0;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border: 1px solid var(--highlight-color);
            color: var(--highlight-color);
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: transparent;
        }

        @media print {
            body { padding: 20px; }
            .header { margin-bottom: 40px; }
            .invoice-title { font-size: 36px; }
        }

        @media (max-width: 640px) {
            body { padding: 20px; }
            .header { flex-direction: column; align-items: flex-start; gap: 20px; }
            .invoice-title { text-align: left; font-size: 32px; }
            .invoice-number { text-align: left; }
            .dates-section { flex-direction: column; gap: 16px; text-align: left; }
            .totals-section { width: 100%; }
        }

    .header { position: relative; }
    .invoice-meta { float: right; max-width: 260px; margin-left: 16px; }
    </style>
</head>
<body>
    <!-- Top title -->
    <div class="title-top">
        <h2 class="invoice-title invoice-title--top">INVOICE</h2>
        {{#invoiceNumber}}<div class="invoice-number invoice-number--top">#{{invoiceNumber}}</div>{{/invoiceNumber}}
    </div>
  <div class="header">
    <div class="invoice-meta">
      <div><strong>Issue Date:</strong> {{issueDate}}</div>
      {{#dueDate}}<div><strong>Due Date:</strong> {{dueDate}}</div>{{/dueDate}}
      <div><strong>Status:</strong> <span class="status-badge">{{status}}</span></div>
    </div>

    <div class="brand">
            <div class="logo-box">
                {{#logoUrl}}<img class="logo" src="{{logoUrl}}" alt="{{companyName}} logo"/>{{/logoUrl}}
            </div>
      <div class="company-info">
        <h1>{{companyName}}</h1>
        <div class="company-details">
          {{#companyAddress}}<p>{{companyAddress}}</p>{{/companyAddress}}
          {{#companyEmail}}<p>{{companyEmail}}</p>{{/companyEmail}}
          {{#companyPhone}}<p>{{companyPhone}}</p>{{/companyPhone}}
          {{#companyTaxId}}<p>{{companyTaxId}}</p>{{/companyTaxId}}
        </div>
      </div>
    </div>

        <script>
            (function(){
                try {
                    var brand = document.querySelector('.brand');
                    if(!brand) return;
                    var logo = brand.querySelector('img.logo');
                    var info = brand.querySelector('.company-info');
                    if(!logo || !info) return;
                    function fit(){
                        try {
                            logo.style.height = 'auto';
                            var h = info.offsetHeight;
                            if(h && h > 0){ logo.style.height = h + 'px'; logo.style.width = 'auto'; }
                        } catch(e){}
                    }
                    if (document.fonts && document.fonts.ready) { document.fonts.ready.then(fit); }
                    window.addEventListener('load', fit);
                    setTimeout(fit, 60);
                } catch(e){}
            })();
        </script>
    <!-- Clear floats below header content -->
    <div style="clear: both;"></div>
  </div>

    <div class="customer-section">
        <div class="section-label">Billed To</div>
        <div class="customer-name">{{customerName}}</div>
        <div class="customer-details">
            {{#customerEmail}}<p>{{customerEmail}}</p>{{/customerEmail}}
            {{#customerPhone}}<p>{{customerPhone}}</p>{{/customerPhone}}
            {{#customerAddress}}<p>{{customerAddress}}</p>{{/customerAddress}}
            {{#customerTaxId}}<p>Tax ID: {{customerTaxId}}</p>{{/customerTaxId}}
        </div>
    </div>

    <div class="items-section">
        <table class="items-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Qty</th>
                    <th>Rate</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {{#items}}
                <tr>
                    <td>
                        <div class="item-description">{{description}}</div>
                        {{#notes}}<div class="item-notes">{{notes}}</div>{{/notes}}
                    </td>
                    <td>{{quantity}}</td>
                    <td>{{currency}} {{unitPrice}}</td>
                    <td>{{currency}} {{lineTotal}}</td>
                </tr>
                {{/items}}
            </tbody>
        </table>
    </div>

    <div class="totals-section">
        <div class="totals-row subtotal">
            <span>Subtotal</span>
            <span>{{currency}} {{subtotal}}</span>
        </div>
        {{#hasDiscount}}
        <div class="totals-row">
            <span>Discount {{#discountPercentage}}({{discountPercentage}}%){{/discountPercentage}}</span>
            <span>-{{currency}} {{discountAmount}}</span>
        </div>
        {{/hasDiscount}}
        {{#hasTax}}
        <div class="totals-row">
            <span>Tax ({{taxRate}}%)</span>
            <span>{{currency}} {{taxAmount}}</span>
        </div>
        {{/hasTax}}
        <div class="totals-row total">
            <span>Total</span>
            <span>{{currency}} {{total}}</span>
        </div>
    </div>

    {{#notes}}
    <div class="notes-section">
        <div class="section-label">Notes</div>
        <div class="notes-content">{{notes}}</div>
    </div>
    {{/notes}}

    <div class="footer">
        {{#paymentTerms}}<p><strong>Payment Terms:</strong> {{paymentTerms}}</p>{{/paymentTerms}}
        {{#paymentMethods}}<p><strong>Payment Methods:</strong> {{paymentMethods}}</p>{{/paymentMethods}}
        {{#bankAccount}}<p><strong>Bank Details:</strong> {{bankAccount}}</p>{{/bankAccount}}
        {{#companyTaxId}}<p>Tax ID: {{companyTaxId}}</p>{{/companyTaxId}}
    </div>
</body>
</html>
